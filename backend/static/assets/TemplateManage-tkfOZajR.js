import{d as B,r as m,o as S,c as M,a as l,E as r,b as s,f as a,n as _,t as N,u as g,k as O,l as U,g as F,y as P,e as q,_ as A}from"./index-C00WT-_0.js";import{A as p}from"./api-8JsUKq5o.js";const D={class:"dialog-footer"},I=B({__name:"TemplateManage",setup(J){const w=m([]),i=m(!1),n=m({id:null,name:"",content:""}),f=m(!1),u=async()=>{try{const e=await fetch(`${p}/api/templates/`);if(!e.ok)throw new Error("获取模板列表失败");w.value=await e.json()}catch{r.error("获取模板列表失败")}},h=async()=>{if(!n.value.name.trim()||!n.value.content.trim()){r.warning("请填写完整的模板信息");return}try{const e=await fetch(`${p}/api/templates/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n.value)});if(!e.ok){const t=await e.json();throw new Error(t.message||"创建模板失败")}r.success("创建模板成功"),i.value=!1,await u()}catch(e){r.error(e instanceof Error?e.message:"创建模板失败")}},b=async()=>{if(n.value.id)try{const e=await fetch(`${p}/api/templates/${n.value.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n.value)});if(!e.ok){const t=await e.json();throw new Error(t.message||"更新模板失败")}r.success("更新模板成功"),i.value=!1,await u()}catch(e){r.error(e instanceof Error?e.message:"更新模板失败")}},T=async e=>{try{if(!await P.confirm("确定删除该方案吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;const c=await fetch(`${p}/api/templates/${e}`,{method:"DELETE"});if(!c.ok){const d=await c.json();throw new Error(d.message||"删除模板失败")}r.success("删除模板成功"),await u()}catch(t){t!=="cancel"&&r.error(t instanceof Error?t.message:"删除模板失败")}},E=e=>{f.value=!0,n.value={id:e.id,name:e.name,content:e.content},i.value=!0},k=async()=>{f.value?await b():await h()};return S(()=>{u()}),(e,t)=>{const c=s("el-table-column"),d=s("el-button"),V=s("el-table"),v=s("el-input"),y=s("el-form-item"),x=s("el-form"),C=s("el-dialog"),$=s("el-container");return q(),M($,{class:"el-container"},{default:l(()=>[a(V,{data:w.value,style:{width:"100%"}},{default:l(()=>[a(c,{prop:"name",label:"方案名称",width:"200"}),a(c,{prop:"content",label:"方案内容","min-width":"400"},{default:l(o=>[_(N(o.row.content.length>80?o.row.content.slice(0,80)+"...":o.row.content),1)]),_:1}),a(c,{label:"操作",width:"180"},{default:l(o=>[a(d,{icon:g(O),circle:"",onClick:j=>E(o.row)},null,8,["icon","onClick"]),a(d,{icon:g(U),circle:"",type:"danger",onClick:j=>T(o.row.id)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"]),a(C,{modelValue:i.value,"onUpdate:modelValue":t[3]||(t[3]=o=>i.value=o),title:f.value?"编辑方案":"新建方案",width:"600px"},{footer:l(()=>[F("span",D,[a(d,{onClick:t[2]||(t[2]=o=>i.value=!1)},{default:l(()=>t[4]||(t[4]=[_("取消")])),_:1,__:[4]}),a(d,{type:"primary",onClick:k},{default:l(()=>t[5]||(t[5]=[_("确定")])),_:1,__:[5]})])]),default:l(()=>[a(x,{model:n.value,"label-width":"80px"},{default:l(()=>[a(y,{label:"方案名称",required:""},{default:l(()=>[a(v,{modelValue:n.value.name,"onUpdate:modelValue":t[0]||(t[0]=o=>n.value.name=o),placeholder:"请输入方案名称"},null,8,["modelValue"])]),_:1}),a(y,{label:"方案内容",required:""},{default:l(()=>[a(v,{modelValue:n.value.content,"onUpdate:modelValue":t[1]||(t[1]=o=>n.value.content=o),type:"textarea",rows:5,placeholder:"请输入方案内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1})}}}),z=A(I,[["__scopeId","data-v-27dc617d"]]);export{z as default};
