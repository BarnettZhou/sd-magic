import{d as Ie,r as i,w as Oe,o as Me,c as b,a as o,E as r,b as c,e as d,f as a,g as s,u as g,p as Z,h,i as ee,t as E,j as te,k as ae,l as oe,m as u,n as Le,s as Je,F as K,q as Q,v as le,x as De,y as ne,_ as qe}from"./index-DFvLh4cL.js";import{A as w}from"./api-8JsUKq5o.js";const ze={class:"category-header"},He={class:"custom-tree-node"},Ke={key:0,class:"actions"},Qe={class:"prompt-header"},Re={class:"category-filter"},Ge={class:"prompt-list"},We={class:"prompt-content"},Xe={class:"prompt-text"},Ye={class:"prompt-translation"},Ze={class:"prompt-category"},et={class:"prompt-actions"},tt={key:0,class:"loading-more"},at={class:"cart-content"},ot={key:0,class:"cart-list"},lt={class:"cart-actions"},nt={class:"cart-section"},st={class:"tags-container"},rt={class:"cart-section"},it={class:"tags-container"},ct={key:1,class:"empty-cart"},ut={class:"cart-footer"},dt={class:"dialog-footer"},pt={class:"dialog-footer"},mt=Ie({__name:"PromptManage",setup(_t){const I=i([]),k=i(null),C=i(!1),y=i({name:"",parent_id:null}),O=i(!1),M=i(null),L=async()=>{try{const t=await fetch(`${w}/api/categories/`);if(!t.ok)throw new Error("获取分类失败");I.value=await t.json()}catch{r.error("获取分类列表失败")}},se=async()=>{try{const t=await fetch(`${w}/api/categories/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y.value)});if(!t.ok){const e=await t.json();throw new Error(e.message||"创建分类失败")}r.success("创建分类成功"),C.value=!1,await L()}catch(t){r.error(t instanceof Error?t.message:"创建分类失败")}},re=async()=>{if(M.value)try{const t=await fetch(`${w}/api/categories/${M.value}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(y.value)});if(!t.ok){const e=await t.json();throw new Error(e.message||"更新分类失败")}r.success("更新分类成功"),C.value=!1,await L()}catch(t){r.error(t instanceof Error?t.message:"更新分类失败")}},ie=async t=>{try{if(!await ne.confirm("确认删除分类？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;const n=await fetch(`${w}/api/categories/${t}`,{method:"DELETE"});if(!n.ok){const m=await n.json();throw new Error(m.message||"删除分类失败")}r.success("删除分类成功"),await L()}catch(e){e!=="cancel"&&r.error(e instanceof Error?e.message:"删除分类失败")}},ce=()=>{O.value=!1,M.value=null,y.value={name:"",parent_id:null},C.value=!0},ue=t=>{O.value=!0,M.value=t.id,y.value={name:t.name,parent_id:t.parentId},C.value=!0},de=async()=>{O.value?await re():await se()},W=t=>{k.value=t},J=i(""),P=i(1),pe=i(20),D=i(!1),S=i(!1),me=i(0),x=i(!1),f=i({original_text:"",chinese_translation:"",category_id:null}),q=i(!1),z=i(null),H=i([]),V=async(t=1)=>{var e;try{D.value=!0;const n=new URLSearchParams({page:t.toString(),per_page:pe.value.toString(),...((e=k.value)==null?void 0:e.id)&&{category_id:k.value.id.toString()},...J.value&&{search:J.value}}),m=await fetch(`${w}/api/prompts/?${n.toString()}`);if(!m.ok)throw new Error("获取提示词失败");const v=await m.json(),F=Array.isArray(v)?v:v.results||[];t===1?H.value=F:H.value=[...H.value,...F],me.value=Array.isArray(v)?F.length:v.count||0,S.value=Array.isArray(v)?!1:v.next===null}catch{r.error("获取提示词列表失败")}finally{D.value=!1}},_e=async()=>{try{const t=await fetch(`${w}/api/prompts/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f.value)});if(!t.ok){const e=await t.json();throw new Error(e.message||"创建提示词失败")}r.success("创建提示词成功"),x.value=!1,P.value=1,await V(1)}catch(t){r.error(t instanceof Error?t.message:"创建提示词失败")}},fe=async()=>{if(z.value)try{const t=await fetch(`${w}/api/prompts/${z.value}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(f.value)});if(!t.ok){const e=await t.json();throw new Error(e.message||"更新提示词失败")}r.success("更新提示词成功"),x.value=!1,P.value=1,S.value=!1,await V(1)}catch(t){r.error(t instanceof Error?t.message:"更新提示词失败")}},ve=async t=>{try{if(!await ne.confirm("是否删除提示词？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;const n=await fetch(`${w}/api/prompts/${t}`,{method:"DELETE"});if(!n.ok){const m=await n.json();throw new Error(m.message||"删除提示词失败")}r.success("删除提示词成功"),await V(P.value)}catch(e){e!=="cancel"&&r.error(e instanceof Error?e.message:"删除提示词失败")}},ge=()=>{var t;q.value=!1,z.value=null,f.value={original_text:"",chinese_translation:"",category_id:((t=k.value)==null?void 0:t.id)||null},x.value=!0},ye=t=>{q.value=!0,z.value=t.id,f.value={original_text:t.original_text,chinese_translation:t.chinese_translation,category_id:t.category_id},x.value=!0},we=async()=>{q.value?await fe():await _e()};Oe(k,()=>{P.value=1,S.value=!1,V(1)});const he=()=>{P.value=1,S.value=!1,V()},ke=t=>{const e=t.target;if(D.value||S.value)return;const{scrollHeight:n,scrollTop:m,clientHeight:v}=e;n-m-v<50&&V(P.value+1)};Me(()=>{L(),V()});const j=i(!1),p=i([]),Ce=t=>{if(p.value.find(n=>n.original_text===t.original_text)){r.warning("提示词已添加到购物车");return}p.value.push({original_text:t.original_text,chinese_translation:t.chinese_translation}),r.success("已添加到购物车")},xe=t=>{const e=p.value.findIndex(n=>n.original_text===t);e>-1&&(p.value.splice(e,1),r.success("已从购物车移除"))},X=()=>{p.value=[],r.success("已清空购物车")},U=i(!1),$=i({name:""}),Ve=()=>{if(!p.value||p.value.length===0){r.warning("购物车为空");return}U.value=!0,$.value.name=""},be=async()=>{if(!$.value.name.trim()){r.warning("请输入方案名称");return}try{const t=p.value.map(n=>n.original_text).join(", ")+",",e=await fetch(`${w}/api/templates/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:$.value.name,content:t})});if(!e.ok){const n=await e.json();throw new Error(n.message||"保存方案失败")}r.success("保存方案成功"),U.value=!1,j.value=!1,X()}catch(t){r.error(t instanceof Error?t.message:"保存方案失败")}},Ee=()=>{const t=p.value.map(e=>e.original_text).join(", ")+",";navigator.clipboard.writeText(t).then(()=>{r.success("已复制到剪贴板")}).catch(()=>{r.error("复制失败，请重试")})},Pe=()=>{j.value=!j.value};return(t,e)=>{const n=c("el-button"),m=c("el-tooltip"),v=c("el-tree"),F=c("el-aside"),N=c("el-tag"),A=c("el-input"),$e=c("el-card"),Te=c("Loading"),Se=c("el-icon"),T=c("el-form-item"),Y=c("el-tree-select"),R=c("el-form"),G=c("el-dialog"),je=c("el-main"),Ue=c("el-badge"),Fe=c("el-alert"),Ne=c("el-empty"),Ae=c("el-drawer"),Be=c("el-container");return d(),b(Be,{class:"prompt-manage"},{default:o(()=>[a(F,{width:"250px",class:"category-aside"},{default:o(()=>[s("div",ze,[e[15]||(e[15]=s("h3",null,"分类管理",-1)),a(m,{content:"新建分类",placement:"top"},{default:o(()=>[a(n,{type:"primary",icon:g(Z),circle:"",onClick:ce},null,8,["icon"])]),_:1})]),a(v,{data:I.value,"node-key":"id",props:{label:"name",children:"children"},onNodeClick:W,"default-expand-all":""},{default:o(({node:l,data:_})=>[s("div",He,[s("span",null,E(l.label),1),_.is_default?ee("",!0):(d(),h("span",Ke,[a(m,{content:"编辑分类",placement:"top"},{default:o(()=>[a(n,{icon:g(ae),circle:"",link:"",onClick:te(B=>ue(_),["stop"])},null,8,["icon","onClick"])]),_:2},1024),a(m,{content:"删除分类",placement:"top"},{default:o(()=>[a(n,{icon:g(oe),circle:"",link:"",type:"danger",onClick:te(B=>ie(_.id),["stop"])},null,8,["icon","onClick"])]),_:2},1024)]))])]),_:1},8,["data"])]),_:1}),a(je,{class:"prompt-main",onScroll:ke},{default:o(()=>[s("div",Qe,[s("div",Re,[e[17]||(e[17]=s("span",null,"当前分类：",-1)),k.value?(d(),b(N,{key:1,type:"success",closable:"",onClose:e[0]||(e[0]=l=>W(null))},{default:o(()=>[u(E(k.value.name),1)]),_:1})):(d(),b(N,{key:0,type:"info"},{default:o(()=>e[16]||(e[16]=[u("全部分类")])),_:1,__:[16]}))]),a(A,{modelValue:J.value,"onUpdate:modelValue":e[1]||(e[1]=l=>J.value=l),placeholder:"搜索提示词...",class:"search-input","prefix-icon":g(Je),onKeyup:Le(he,["enter"])},null,8,["modelValue","prefix-icon"]),a(n,{type:"primary",icon:g(Z),onClick:ge},{default:o(()=>e[18]||(e[18]=[u("添加提示词")])),_:1,__:[18]},8,["icon"])]),s("div",Ge,[(d(!0),h(K,null,Q(H.value,l=>(d(),b($e,{key:l.id,class:"prompt-card"},{default:o(()=>[s("div",We,[s("div",Xe,E(l.original_text),1),s("div",Ye,E(l.chinese_translation),1),s("div",Ze,[(d(!0),h(K,null,Q(l.categoryPath,(_,B)=>(d(),b(N,{key:B,size:"small",type:B===0?"":"info"},{default:o(()=>[u(E(_),1)]),_:2},1032,["type"]))),128))])]),s("div",et,[a(n,{icon:g(le),circle:"",onClick:_=>Ce(l)},null,8,["icon","onClick"]),a(n,{icon:g(ae),circle:"",onClick:_=>ye(l)},null,8,["icon","onClick"]),a(n,{icon:g(oe),circle:"",type:"danger",onClick:_=>ve(l.id)},null,8,["icon","onClick"])])]),_:2},1024))),128)),D.value?(d(),h("div",tt,[a(Se,{class:"is-loading"},{default:o(()=>[a(Te)]),_:1}),e[19]||(e[19]=s("span",null,"加载中...",-1))])):ee("",!0)]),a(G,{modelValue:x.value,"onUpdate:modelValue":e[6]||(e[6]=l=>x.value=l),title:q.value?"编辑提示词":"添加提示词",width:"500px"},{footer:o(()=>[a(n,{onClick:e[5]||(e[5]=l=>x.value=!1)},{default:o(()=>e[20]||(e[20]=[u("取消")])),_:1,__:[20]}),a(n,{type:"primary",onClick:we},{default:o(()=>e[21]||(e[21]=[u("确定")])),_:1,__:[21]})]),default:o(()=>[a(R,{model:f.value,"label-width":"100px"},{default:o(()=>[a(T,{label:"提示词原文",required:""},{default:o(()=>[a(A,{modelValue:f.value.original_text,"onUpdate:modelValue":e[2]||(e[2]=l=>f.value.original_text=l),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),a(T,{label:"中文翻译"},{default:o(()=>[a(A,{modelValue:f.value.chinese_translation,"onUpdate:modelValue":e[3]||(e[3]=l=>f.value.chinese_translation=l),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),a(T,{label:"所属分类",required:""},{default:o(()=>[a(Y,{modelValue:f.value.category_id,"onUpdate:modelValue":e[4]||(e[4]=l=>f.value.category_id=l),data:I.value,props:{value:"id",label:"name",children:"children"},"check-strictly":""},null,8,["modelValue","data"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1}),s("div",{class:"cart-button",onClick:Pe},[a(Ue,{value:p.value.length,hidden:!p.value.length},{default:o(()=>[a(n,{icon:g(le),circle:"",type:"primary",size:"large"},null,8,["icon"])]),_:1},8,["value","hidden"])]),a(Ae,{modelValue:j.value,"onUpdate:modelValue":e[7]||(e[7]=l=>j.value=l),title:"购物车",direction:"rtl",size:"400px"},{default:o(()=>[s("div",at,[a(Fe,{title:"提示",type:"info",closable:!1,"show-icon":""},{default:o(()=>e[22]||(e[22]=[u(" 点击提示词可移除，点击保存按钮可保存当前方案 ")])),_:1,__:[22]}),p.value.length>0?(d(),h("div",ot,[s("div",lt,[a(n,{type:"primary",onClick:Ee,icon:g(De)},{default:o(()=>e[23]||(e[23]=[u(" 复制提示词 ")])),_:1,__:[23]},8,["icon"])]),s("div",nt,[e[24]||(e[24]=s("div",{class:"section-title"},"提示词原文",-1)),s("div",st,[(d(!0),h(K,null,Q(p.value,(l,_)=>(d(),b(N,{key:_,closable:"",onClose:B=>xe(l.original_text),class:"cart-tag"},{default:o(()=>[u(E(l.original_text),1)]),_:2},1032,["onClose"]))),128))])]),s("div",rt,[e[25]||(e[25]=s("div",{class:"section-title"},"中文翻译",-1)),s("div",it,[(d(!0),h(K,null,Q(p.value,(l,_)=>(d(),b(N,{key:_,type:"info",class:"cart-tag-translation"},{default:o(()=>[u(E(l.chinese_translation),1)]),_:2},1024))),128))])])])):(d(),h("div",ct,[a(Ne,{description:"购物车为空"})]))])]),footer:o(()=>[s("div",ut,[a(n,{onClick:X},{default:o(()=>e[26]||(e[26]=[u("清空购物车")])),_:1,__:[26]}),a(n,{type:"primary",onClick:Ve},{default:o(()=>e[27]||(e[27]=[u("保存为方案")])),_:1,__:[27]})])]),_:1},8,["modelValue"]),a(G,{modelValue:U.value,"onUpdate:modelValue":e[10]||(e[10]=l=>U.value=l),title:"保存方案",width:"400px"},{footer:o(()=>[s("span",dt,[a(n,{onClick:e[9]||(e[9]=l=>U.value=!1)},{default:o(()=>e[28]||(e[28]=[u("取消")])),_:1,__:[28]}),a(n,{type:"primary",onClick:be},{default:o(()=>e[29]||(e[29]=[u("保存")])),_:1,__:[29]})])]),default:o(()=>[a(R,{model:$.value,"label-width":"80px"},{default:o(()=>[a(T,{label:"方案名称"},{default:o(()=>[a(A,{modelValue:$.value.name,"onUpdate:modelValue":e[8]||(e[8]=l=>$.value.name=l),placeholder:"请输入方案名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(G,{modelValue:C.value,"onUpdate:modelValue":e[14]||(e[14]=l=>C.value=l),title:O.value?"编辑分类":"新建分类",width:"30%"},{footer:o(()=>[s("span",pt,[a(n,{onClick:e[13]||(e[13]=l=>C.value=!1)},{default:o(()=>e[30]||(e[30]=[u("取消")])),_:1,__:[30]}),a(n,{type:"primary",onClick:de},{default:o(()=>e[31]||(e[31]=[u("确定")])),_:1,__:[31]})])]),default:o(()=>[a(R,{model:y.value,"label-width":"80px"},{default:o(()=>[a(T,{label:"分类名称"},{default:o(()=>[a(A,{modelValue:y.value.name,"onUpdate:modelValue":e[11]||(e[11]=l=>y.value.name=l),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),a(T,{label:"父级分类"},{default:o(()=>[a(Y,{modelValue:y.value.parent_id,"onUpdate:modelValue":e[12]||(e[12]=l=>y.value.parent_id=l),data:I.value,props:{label:"name",children:"children",value:"id"},placeholder:"请选择父级分类",clearable:"","check-strictly":""},null,8,["modelValue","data"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1})}}}),gt=qe(mt,[["__scopeId","data-v-b765d70a"]]);export{gt as default};
