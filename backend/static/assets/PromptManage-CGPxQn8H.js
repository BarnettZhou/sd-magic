import{d as Le,r as i,w as Je,o as qe,c as b,a as l,E as r,b as c,e as p,f as a,g as s,u as y,p as te,h as x,i as ae,t as $,j as le,k as oe,l as ne,m as d,n as De,s as ze,F as Q,q as R,v as se,x as Ae,y as re,_ as He}from"./index-CWMpETze.js";import{A as f}from"./api-8JsUKq5o.js";const Ke={class:"category-header"},Qe={class:"custom-tree-node"},Re={key:0,class:"actions"},Ge={class:"prompt-header"},We={class:"category-filter"},Xe={class:"prompt-list"},Ye={class:"prompt-content"},Ze={class:"prompt-text"},et={class:"prompt-translation"},tt={class:"prompt-category"},at={class:"prompt-actions"},lt={key:0,class:"loading-more"},ot={class:"cart-content"},nt={key:0,class:"cart-list"},st={class:"cart-actions"},rt={class:"cart-section"},it={class:"tags-container"},ut={class:"cart-section"},ct={class:"tags-container"},dt={key:1,class:"empty-cart"},pt={class:"cart-footer"},mt={class:"dialog-footer"},ft={class:"dialog-footer"},vt=Le({__name:"PromptManage",setup(_t){const L=i([]),k=i(null),C=i(!1),w=i({name:"",parent_id:null}),J=i(!1),q=i(null),D=async()=>{try{const t=await fetch(`${f}/api/categories/`);if(!t.ok)throw new Error("获取分类失败");L.value=await t.json()}catch{r.error("获取分类列表失败")}},ie=async()=>{try{const t=await fetch(`${f}/api/categories/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(w.value)});if(!t.ok){const e=await t.json();throw new Error(e.message||"创建分类失败")}r.success("创建分类成功"),C.value=!1,await D()}catch(t){r.error(t instanceof Error?t.message:"创建分类失败")}},ue=async()=>{if(q.value)try{const t=await fetch(`${f}/api/categories/${q.value}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(w.value)});if(!t.ok){const e=await t.json();throw new Error(e.message||"更新分类失败")}r.success("更新分类成功"),C.value=!1,await D()}catch(t){r.error(t instanceof Error?t.message:"更新分类失败")}},ce=async t=>{try{if(!await re.confirm("确认删除分类？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;const o=await fetch(`${f}/api/categories/${t}`,{method:"DELETE"});if(!o.ok){const u=await o.json();throw new Error(u.message||"删除分类失败")}r.success("删除分类成功"),await D()}catch(e){e!=="cancel"&&r.error(e instanceof Error?e.message:"删除分类失败")}},de=()=>{J.value=!1,q.value=null,w.value={name:"",parent_id:null},C.value=!0},pe=t=>{J.value=!0,q.value=t.id,w.value={name:t.name,parent_id:t.parentId},C.value=!0},me=async()=>{J.value?await ue():await ie()},Y=t=>{k.value=t},z=i(""),A=i(1),fe=i(50),V=i(!1),h=i(!1),G=i(0),E=i(!1),_=i({original_text:"",chinese_translation:"",category_id:null}),H=i(!1),K=i(null),P=i([]),T=i(null),S=async(t=null)=>{var e;try{if(V.value=!0,t){const o=await fetch(t);if(!o.ok)throw new Error("获取提示词失败");const u=await o.json();if(!u.results)throw new Error("无效的响应格式");return P.value=[...P.value,...u.results],G.value+=u.results.length,h.value=!u.next,u.next&&(T.value=`${f}${u.next}`),u.next?`${f}${u.next}`:null}else{const o=new URLSearchParams({skip:"0",limit:fe.value.toString(),...((e=k.value)==null?void 0:e.id)&&{category_id:k.value.id.toString()},...z.value&&{search:z.value}}),u=`${f}/api/prompts/?${o.toString()}`,U=await fetch(u);if(!U.ok)throw new Error("获取提示词失败");const g=await U.json();if(!g.results)throw new Error("无效的响应格式");return P.value=g.results,G.value=g.count,h.value=!g.next,g.next&&(T.value=`${f}${g.next}`),g.next?`${f}${g.next}`:null}}catch(o){return r.error(o instanceof Error?o.message:"获取提示词列表失败"),null}finally{V.value=!1}},ve=async()=>{try{const t=await fetch(`${f}/api/prompts/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_.value)});if(!t.ok){const e=await t.json();throw new Error(e.message||"创建提示词失败")}r.success("创建提示词成功"),E.value=!1,A.value=1,await S(null)}catch(t){r.error(t instanceof Error?t.message:"创建提示词失败")}},_e=async()=>{if(K.value)try{const t=await fetch(`${f}/api/prompts/${K.value}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(_.value)});if(!t.ok){const e=await t.json();throw new Error(e.message||"更新提示词失败")}r.success("更新提示词成功"),E.value=!1,A.value=1,h.value=!1,await S(null)}catch(t){r.error(t instanceof Error?t.message:"更新提示词失败")}},ge=async t=>{try{if(!await re.confirm("是否删除提示词？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;const o=await fetch(`${f}/api/prompts/${t}`,{method:"DELETE"});if(!o.ok){const u=await o.json();throw new Error(u.message||"删除提示词失败")}r.success("删除提示词成功"),await S(null)}catch(e){e!=="cancel"&&r.error(e instanceof Error?e.message:"删除提示词失败")}},ye=()=>{var t;H.value=!1,K.value=null,_.value={original_text:"",chinese_translation:"",category_id:((t=k.value)==null?void 0:t.id)||null},E.value=!0},we=t=>{H.value=!0,K.value=t.id,_.value={original_text:t.original_text,chinese_translation:t.chinese_translation,category_id:t.category_id},E.value=!0},he=async()=>{H.value?await _e():await ve()};Je(k,()=>{A.value=1,h.value=!1,S(null)});const xe=()=>{A.value=1,h.value=!1,S()},ke=async()=>{if(!(V.value||h.value)&&T.value)try{V.value=!0;const t=await fetch(T.value);if(!t.ok)throw new Error("加载失败");const e=await t.json();if(!e.results)throw new Error("无效的响应格式");P.value=[...P.value,...e.results],G.value+=e.results.length,h.value=!e.next,e.next?T.value=`${f}${e.next}`:T.value=null}catch(t){r.error(t instanceof Error?t.message:"加载失败")}finally{V.value=!1}},Ce=t=>{const e=t.target;if(V.value||h.value)return;const{scrollHeight:o,scrollTop:u,clientHeight:U}=e;o-u-U<50&&ke()};qe(()=>{D(),S(null)});const N=i(!1),m=i([]),Ve=t=>{if(m.value.find(o=>o.original_text===t.original_text)){r.warning("提示词已添加到购物车");return}m.value.push({original_text:t.original_text,chinese_translation:t.chinese_translation}),r.success("已添加到购物车")},Ee=t=>{const e=m.value.findIndex(o=>o.original_text===t);e>-1&&(m.value.splice(e,1),r.success("已从购物车移除"))},Z=()=>{m.value=[],r.success("已清空购物车")},B=i(!1),j=i({name:""}),be=()=>{if(!m.value||m.value.length===0){r.warning("购物车为空");return}B.value=!0,j.value.name=""},$e=async()=>{if(!j.value.name.trim()){r.warning("请输入方案名称");return}try{const t=m.value.map(o=>o.original_text).join(", ")+",",e=await fetch(`${f}/api/templates/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:j.value.name,content:t})});if(!e.ok){const o=await e.json();throw new Error(o.message||"保存方案失败")}r.success("保存方案成功"),B.value=!1,N.value=!1,Z()}catch(t){r.error(t instanceof Error?t.message:"保存方案失败")}},Pe=()=>{const t=m.value.map(e=>e.original_text).join(", ")+",";navigator.clipboard.writeText(t).then(()=>{r.success("已复制到剪贴板")}).catch(()=>{r.error("复制失败，请重试")})},Te=()=>{N.value=!N.value};return(t,e)=>{const o=c("el-button"),u=c("el-tooltip"),U=c("el-tree"),g=c("el-aside"),I=c("el-tag"),O=c("el-input"),Se=c("el-card"),je=c("Loading"),Ue=c("el-icon"),F=c("el-form-item"),ee=c("el-tree-select"),W=c("el-form"),X=c("el-dialog"),Fe=c("el-main"),Ne=c("el-badge"),Be=c("el-alert"),Ie=c("el-empty"),Oe=c("el-drawer"),Me=c("el-container");return p(),b(Me,{class:"prompt-manage"},{default:l(()=>[a(g,{width:"250px",class:"category-aside"},{default:l(()=>[s("div",Ke,[e[15]||(e[15]=s("h3",null,"分类管理",-1)),a(u,{content:"新建分类",placement:"top"},{default:l(()=>[a(o,{type:"primary",icon:y(te),circle:"",onClick:de},null,8,["icon"])]),_:1})]),a(U,{data:L.value,"node-key":"id",props:{label:"name",children:"children"},onNodeClick:Y,"default-expand-all":""},{default:l(({node:n,data:v})=>[s("div",Qe,[s("span",null,$(n.label),1),v.is_default?ae("",!0):(p(),x("span",Re,[a(u,{content:"编辑分类",placement:"top"},{default:l(()=>[a(o,{icon:y(oe),circle:"",link:"",onClick:le(M=>pe(v),["stop"])},null,8,["icon","onClick"])]),_:2},1024),a(u,{content:"删除分类",placement:"top"},{default:l(()=>[a(o,{icon:y(ne),circle:"",link:"",type:"danger",onClick:le(M=>ce(v.id),["stop"])},null,8,["icon","onClick"])]),_:2},1024)]))])]),_:1},8,["data"])]),_:1}),a(Fe,{class:"prompt-main",onScroll:Ce},{default:l(()=>[s("div",Ge,[s("div",We,[e[17]||(e[17]=s("span",null,"当前分类：",-1)),k.value?(p(),b(I,{key:1,type:"success",closable:"",onClose:e[0]||(e[0]=n=>Y(null))},{default:l(()=>[d($(k.value.name),1)]),_:1})):(p(),b(I,{key:0,type:"info"},{default:l(()=>e[16]||(e[16]=[d("全部分类")])),_:1,__:[16]}))]),a(O,{modelValue:z.value,"onUpdate:modelValue":e[1]||(e[1]=n=>z.value=n),placeholder:"搜索提示词...",class:"search-input","prefix-icon":y(ze),onKeyup:De(xe,["enter"])},null,8,["modelValue","prefix-icon"]),a(o,{type:"primary",icon:y(te),onClick:ye},{default:l(()=>e[18]||(e[18]=[d("添加提示词")])),_:1,__:[18]},8,["icon"])]),s("div",Xe,[(p(!0),x(Q,null,R(P.value,n=>(p(),b(Se,{key:n.id,class:"prompt-card"},{default:l(()=>[s("div",Ye,[s("div",Ze,$(n.original_text),1),s("div",et,$(n.chinese_translation),1),s("div",tt,[(p(!0),x(Q,null,R(n.categoryPath,(v,M)=>(p(),b(I,{key:M,size:"small",type:M===0?"":"info"},{default:l(()=>[d($(v),1)]),_:2},1032,["type"]))),128))])]),s("div",at,[a(o,{icon:y(se),circle:"",onClick:v=>Ve(n)},null,8,["icon","onClick"]),a(o,{icon:y(oe),circle:"",onClick:v=>we(n)},null,8,["icon","onClick"]),a(o,{icon:y(ne),circle:"",type:"danger",onClick:v=>ge(n.id)},null,8,["icon","onClick"])])]),_:2},1024))),128)),V.value?(p(),x("div",lt,[a(Ue,{class:"is-loading"},{default:l(()=>[a(je)]),_:1}),e[19]||(e[19]=s("span",null,"加载中...",-1))])):ae("",!0)]),a(X,{modelValue:E.value,"onUpdate:modelValue":e[6]||(e[6]=n=>E.value=n),title:H.value?"编辑提示词":"添加提示词",width:"500px"},{footer:l(()=>[a(o,{onClick:e[5]||(e[5]=n=>E.value=!1)},{default:l(()=>e[20]||(e[20]=[d("取消")])),_:1,__:[20]}),a(o,{type:"primary",onClick:he},{default:l(()=>e[21]||(e[21]=[d("确定")])),_:1,__:[21]})]),default:l(()=>[a(W,{model:_.value,"label-width":"100px"},{default:l(()=>[a(F,{label:"提示词原文",required:""},{default:l(()=>[a(O,{modelValue:_.value.original_text,"onUpdate:modelValue":e[2]||(e[2]=n=>_.value.original_text=n),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),a(F,{label:"中文翻译"},{default:l(()=>[a(O,{modelValue:_.value.chinese_translation,"onUpdate:modelValue":e[3]||(e[3]=n=>_.value.chinese_translation=n),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),a(F,{label:"所属分类",required:""},{default:l(()=>[a(ee,{modelValue:_.value.category_id,"onUpdate:modelValue":e[4]||(e[4]=n=>_.value.category_id=n),data:L.value,props:{value:"id",label:"name",children:"children"},"check-strictly":""},null,8,["modelValue","data"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1}),s("div",{class:"cart-button",onClick:Te},[a(Ne,{value:m.value.length,hidden:!m.value.length},{default:l(()=>[a(o,{icon:y(se),circle:"",type:"primary",size:"large"},null,8,["icon"])]),_:1},8,["value","hidden"])]),a(Oe,{modelValue:N.value,"onUpdate:modelValue":e[7]||(e[7]=n=>N.value=n),title:"购物车",direction:"rtl",size:"400px"},{default:l(()=>[s("div",ot,[a(Be,{title:"提示",type:"info",closable:!1,"show-icon":""},{default:l(()=>e[22]||(e[22]=[d(" 点击提示词可移除，点击保存按钮可保存当前方案 ")])),_:1,__:[22]}),m.value.length>0?(p(),x("div",nt,[s("div",st,[a(o,{type:"primary",onClick:Pe,icon:y(Ae)},{default:l(()=>e[23]||(e[23]=[d(" 复制提示词 ")])),_:1,__:[23]},8,["icon"])]),s("div",rt,[e[24]||(e[24]=s("div",{class:"section-title"},"提示词原文",-1)),s("div",it,[(p(!0),x(Q,null,R(m.value,(n,v)=>(p(),b(I,{key:v,closable:"",onClose:M=>Ee(n.original_text),class:"cart-tag"},{default:l(()=>[d($(n.original_text),1)]),_:2},1032,["onClose"]))),128))])]),s("div",ut,[e[25]||(e[25]=s("div",{class:"section-title"},"中文翻译",-1)),s("div",ct,[(p(!0),x(Q,null,R(m.value,(n,v)=>(p(),b(I,{key:v,type:"info",class:"cart-tag-translation"},{default:l(()=>[d($(n.chinese_translation),1)]),_:2},1024))),128))])])])):(p(),x("div",dt,[a(Ie,{description:"购物车为空"})]))])]),footer:l(()=>[s("div",pt,[a(o,{onClick:Z},{default:l(()=>e[26]||(e[26]=[d("清空购物车")])),_:1,__:[26]}),a(o,{type:"primary",onClick:be},{default:l(()=>e[27]||(e[27]=[d("保存为方案")])),_:1,__:[27]})])]),_:1},8,["modelValue"]),a(X,{modelValue:B.value,"onUpdate:modelValue":e[10]||(e[10]=n=>B.value=n),title:"保存方案",width:"400px"},{footer:l(()=>[s("span",mt,[a(o,{onClick:e[9]||(e[9]=n=>B.value=!1)},{default:l(()=>e[28]||(e[28]=[d("取消")])),_:1,__:[28]}),a(o,{type:"primary",onClick:$e},{default:l(()=>e[29]||(e[29]=[d("保存")])),_:1,__:[29]})])]),default:l(()=>[a(W,{model:j.value,"label-width":"80px"},{default:l(()=>[a(F,{label:"方案名称"},{default:l(()=>[a(O,{modelValue:j.value.name,"onUpdate:modelValue":e[8]||(e[8]=n=>j.value.name=n),placeholder:"请输入方案名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(X,{modelValue:C.value,"onUpdate:modelValue":e[14]||(e[14]=n=>C.value=n),title:J.value?"编辑分类":"新建分类",width:"30%"},{footer:l(()=>[s("span",ft,[a(o,{onClick:e[13]||(e[13]=n=>C.value=!1)},{default:l(()=>e[30]||(e[30]=[d("取消")])),_:1,__:[30]}),a(o,{type:"primary",onClick:me},{default:l(()=>e[31]||(e[31]=[d("确定")])),_:1,__:[31]})])]),default:l(()=>[a(W,{model:w.value,"label-width":"80px"},{default:l(()=>[a(F,{label:"分类名称"},{default:l(()=>[a(O,{modelValue:w.value.name,"onUpdate:modelValue":e[11]||(e[11]=n=>w.value.name=n),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),a(F,{label:"父级分类"},{default:l(()=>[a(ee,{modelValue:w.value.parent_id,"onUpdate:modelValue":e[12]||(e[12]=n=>w.value.parent_id=n),data:L.value,props:{label:"name",children:"children",value:"id"},placeholder:"请选择父级分类",clearable:"","check-strictly":""},null,8,["modelValue","data"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1})}}}),wt=He(vt,[["__scopeId","data-v-e54d4952"]]);export{wt as default};
