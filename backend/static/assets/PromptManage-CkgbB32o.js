import{d as Ie,r as i,w as Oe,o as Me,c as A,a as o,E as s,b as c,e as p,f as a,g as r,u as g,p as Y,h,i as Z,t as P,j as ee,k as te,l as ae,m as Le,s as Je,n as d,F as H,q as K,v as oe,x as De,y as le,_ as qe}from"./index-C00WT-_0.js";import{A as w}from"./api-8JsUKq5o.js";const ze={class:"category-header"},He={class:"custom-tree-node"},Ke={key:0,class:"actions"},Qe={class:"prompt-header"},Re={class:"prompt-list"},Ge={class:"prompt-content"},We={class:"prompt-text"},Xe={class:"prompt-translation"},Ye={class:"prompt-category"},Ze={class:"prompt-actions"},et={key:0,class:"loading-more"},tt={class:"cart-content"},at={key:0,class:"cart-list"},ot={class:"cart-actions"},lt={class:"cart-section"},nt={class:"tags-container"},st={class:"cart-section"},rt={class:"tags-container"},it={key:1,class:"empty-cart"},ct={class:"cart-footer"},ut={class:"dialog-footer"},dt={class:"dialog-footer"},pt=Ie({__name:"PromptManage",setup(mt){const B=i([]),$=i(null),k=i(!1),y=i({name:"",parent_id:null}),I=i(!1),O=i(null),M=async()=>{try{const t=await fetch(`${w}/api/categories/`);if(!t.ok)throw new Error("获取分类失败");B.value=await t.json()}catch{s.error("获取分类列表失败")}},ne=async()=>{try{const t=await fetch(`${w}/api/categories/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y.value)});if(!t.ok){const e=await t.json();throw new Error(e.message||"创建分类失败")}s.success("创建分类成功"),k.value=!1,await M()}catch(t){s.error(t instanceof Error?t.message:"创建分类失败")}},se=async()=>{if(O.value)try{const t=await fetch(`${w}/api/categories/${O.value}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(y.value)});if(!t.ok){const e=await t.json();throw new Error(e.message||"更新分类失败")}s.success("更新分类成功"),k.value=!1,await M()}catch(t){s.error(t instanceof Error?t.message:"更新分类失败")}},re=async t=>{try{if(!await le.confirm("确认删除分类？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;const n=await fetch(`${w}/api/categories/${t}`,{method:"DELETE"});if(!n.ok){const m=await n.json();throw new Error(m.message||"删除分类失败")}s.success("删除分类成功"),await M()}catch(e){e!=="cancel"&&s.error(e instanceof Error?e.message:"删除分类失败")}},ie=()=>{I.value=!1,O.value=null,y.value={name:"",parent_id:null},k.value=!0},ce=t=>{I.value=!0,O.value=t.id,y.value={name:t.name,parent_id:t.parentId},k.value=!0},ue=async()=>{I.value?await se():await ne()},de=t=>{$.value=t},L=i(""),V=i(1),pe=i(20),J=i(!1),T=i(!1),me=i(0),C=i(!1),f=i({original_text:"",chinese_translation:"",category_id:null}),D=i(!1),q=i(null),z=i([]),x=async(t=1)=>{var e;try{J.value=!0;const n=new URLSearchParams({page:t.toString(),per_page:pe.value.toString(),...((e=$.value)==null?void 0:e.id)&&{category_id:$.value.id.toString()},...L.value&&{search:L.value}}),m=await fetch(`${w}/api/prompts/?${n.toString()}`);if(!m.ok)throw new Error("获取提示词失败");const v=await m.json(),U=Array.isArray(v)?v:v.results||[];t===1?z.value=U:z.value=[...z.value,...U],me.value=Array.isArray(v)?U.length:v.count||0,T.value=Array.isArray(v)?!1:v.next===null}catch{s.error("获取提示词列表失败")}finally{J.value=!1}},_e=async()=>{try{const t=await fetch(`${w}/api/prompts/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f.value)});if(!t.ok){const e=await t.json();throw new Error(e.message||"创建提示词失败")}s.success("创建提示词成功"),C.value=!1,V.value=1,await x(1)}catch(t){s.error(t instanceof Error?t.message:"创建提示词失败")}},fe=async()=>{if(q.value)try{const t=await fetch(`${w}/api/prompts/${q.value}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(f.value)});if(!t.ok){const e=await t.json();throw new Error(e.message||"更新提示词失败")}s.success("更新提示词成功"),C.value=!1,V.value=1,T.value=!1,await x(1)}catch(t){s.error(t instanceof Error?t.message:"更新提示词失败")}},ve=async t=>{try{if(!await le.confirm("是否删除提示词？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}))return;const n=await fetch(`${w}/api/prompts/${t}`,{method:"DELETE"});if(!n.ok){const m=await n.json();throw new Error(m.message||"删除提示词失败")}s.success("删除提示词成功"),await x(V.value)}catch(e){e!=="cancel"&&s.error(e instanceof Error?e.message:"删除提示词失败")}},ge=()=>{var t;D.value=!1,q.value=null,f.value={original_text:"",chinese_translation:"",category_id:((t=$.value)==null?void 0:t.id)||null},C.value=!0},ye=t=>{D.value=!0,q.value=t.id,f.value={original_text:t.original_text,chinese_translation:t.chinese_translation,category_id:t.category_id},C.value=!0},we=async()=>{D.value?await fe():await _e()};Oe($,()=>{V.value=1,T.value=!1,x(1)});const he=()=>{V.value=1,T.value=!1,x(1)},ke=t=>{const e=t.target;if(J.value||T.value)return;const{scrollHeight:n,scrollTop:m,clientHeight:v}=e;n-m-v<50&&x(V.value+1)};Me(()=>{M(),x()});const S=i(!1),u=i([]),Ce=t=>{if(u.value.find(n=>n.original_text===t.original_text)){s.warning("提示词已添加到购物车");return}u.value.push({original_text:t.original_text,chinese_translation:t.chinese_translation}),s.success("已添加到购物车")},xe=t=>{const e=u.value.findIndex(n=>n.original_text===t);e>-1&&(u.value.splice(e,1),s.success("已从购物车移除"))},W=()=>{u.value=[],s.success("已清空购物车")},j=i(!1),b=i({name:""}),Ve=()=>{if(!u.value||u.value.length===0){s.warning("购物车为空");return}j.value=!0,b.value.name=""},be=async()=>{if(!b.value.name.trim()){s.warning("请输入方案名称");return}try{const t=u.value.map(n=>n.original_text).join(", ")+",",e=await fetch(`${w}/api/templates/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:b.value.name,content:t})});if(!e.ok){const n=await e.json();throw new Error(n.message||"保存方案失败")}s.success("保存方案成功"),j.value=!1,S.value=!1,W()}catch(t){s.error(t instanceof Error?t.message:"保存方案失败")}},Ee=()=>{const t=u.value.map(e=>e.original_text).join(", ")+",";navigator.clipboard.writeText(t).then(()=>{s.success("已复制到剪贴板")}).catch(()=>{s.error("复制失败，请重试")})},Pe=()=>{S.value=!S.value};return(t,e)=>{const n=c("el-button"),m=c("el-tooltip"),v=c("el-tree"),U=c("el-aside"),F=c("el-input"),Q=c("el-tag"),$e=c("el-card"),Te=c("Loading"),Se=c("el-icon"),E=c("el-form-item"),X=c("el-tree-select"),R=c("el-form"),G=c("el-dialog"),je=c("el-main"),Ue=c("el-badge"),Fe=c("el-alert"),Ne=c("el-empty"),Ae=c("el-drawer"),Be=c("el-container");return p(),A(Be,{class:"prompt-manage"},{default:o(()=>[a(U,{width:"250px",class:"category-aside"},{default:o(()=>[r("div",ze,[e[14]||(e[14]=r("h3",null,"分类管理",-1)),a(m,{content:"新建分类",placement:"top"},{default:o(()=>[a(n,{type:"primary",icon:g(Y),circle:"",onClick:ie},null,8,["icon"])]),_:1})]),a(v,{data:B.value,"node-key":"id",props:{label:"name",children:"children"},onNodeClick:de,"default-expand-all":""},{default:o(({node:l,data:_})=>[r("div",He,[r("span",null,P(l.label),1),_.is_default?Z("",!0):(p(),h("span",Ke,[a(m,{content:"编辑分类",placement:"top"},{default:o(()=>[a(n,{icon:g(te),circle:"",link:"",onClick:ee(N=>ce(_),["stop"])},null,8,["icon","onClick"])]),_:2},1024),a(m,{content:"删除分类",placement:"top"},{default:o(()=>[a(n,{icon:g(ae),circle:"",link:"",type:"danger",onClick:ee(N=>re(_.id),["stop"])},null,8,["icon","onClick"])]),_:2},1024)]))])]),_:1},8,["data"])]),_:1}),a(je,{class:"prompt-main",onScroll:ke},{default:o(()=>[r("div",Qe,[a(F,{modelValue:L.value,"onUpdate:modelValue":e[0]||(e[0]=l=>L.value=l),placeholder:"搜索提示词...",class:"search-input","prefix-icon":g(Je),onKeyup:Le(he,["enter"])},null,8,["modelValue","prefix-icon"]),a(n,{type:"primary",icon:g(Y),onClick:ge},{default:o(()=>e[15]||(e[15]=[d("添加提示词")])),_:1,__:[15]},8,["icon"])]),r("div",Re,[(p(!0),h(H,null,K(z.value,l=>(p(),A($e,{key:l.id,class:"prompt-card"},{default:o(()=>[r("div",Ge,[r("div",We,P(l.original_text),1),r("div",Xe,P(l.chinese_translation),1),r("div",Ye,[(p(!0),h(H,null,K(l.categoryPath,(_,N)=>(p(),A(Q,{key:N,size:"small",type:N===0?"":"info"},{default:o(()=>[d(P(_),1)]),_:2},1032,["type"]))),128))])]),r("div",Ze,[a(n,{icon:g(oe),circle:"",onClick:_=>Ce(l)},null,8,["icon","onClick"]),a(n,{icon:g(te),circle:"",onClick:_=>ye(l)},null,8,["icon","onClick"]),a(n,{icon:g(ae),circle:"",type:"danger",onClick:_=>ve(l.id)},null,8,["icon","onClick"])])]),_:2},1024))),128)),J.value?(p(),h("div",et,[a(Se,{class:"is-loading"},{default:o(()=>[a(Te)]),_:1}),e[16]||(e[16]=r("span",null,"加载中...",-1))])):Z("",!0)]),a(G,{modelValue:C.value,"onUpdate:modelValue":e[5]||(e[5]=l=>C.value=l),title:D.value?"编辑提示词":"添加提示词",width:"500px"},{footer:o(()=>[a(n,{onClick:e[4]||(e[4]=l=>C.value=!1)},{default:o(()=>e[17]||(e[17]=[d("取消")])),_:1,__:[17]}),a(n,{type:"primary",onClick:we},{default:o(()=>e[18]||(e[18]=[d("确定")])),_:1,__:[18]})]),default:o(()=>[a(R,{model:f.value,"label-width":"100px"},{default:o(()=>[a(E,{label:"提示词原文",required:""},{default:o(()=>[a(F,{modelValue:f.value.original_text,"onUpdate:modelValue":e[1]||(e[1]=l=>f.value.original_text=l),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),a(E,{label:"中文翻译"},{default:o(()=>[a(F,{modelValue:f.value.chinese_translation,"onUpdate:modelValue":e[2]||(e[2]=l=>f.value.chinese_translation=l),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),a(E,{label:"所属分类",required:""},{default:o(()=>[a(X,{modelValue:f.value.category_id,"onUpdate:modelValue":e[3]||(e[3]=l=>f.value.category_id=l),data:B.value,props:{value:"id",label:"name",children:"children"},"check-strictly":""},null,8,["modelValue","data"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1}),r("div",{class:"cart-button",onClick:Pe},[a(Ue,{value:u.value.length,hidden:!u.value.length},{default:o(()=>[a(n,{icon:g(oe),circle:"",type:"primary",size:"large"},null,8,["icon"])]),_:1},8,["value","hidden"])]),a(Ae,{modelValue:S.value,"onUpdate:modelValue":e[6]||(e[6]=l=>S.value=l),title:"购物车",direction:"rtl",size:"400px"},{default:o(()=>[r("div",tt,[a(Fe,{title:"提示",type:"info",closable:!1,"show-icon":""},{default:o(()=>e[19]||(e[19]=[d(" 点击提示词可移除，点击保存按钮可保存当前方案 ")])),_:1,__:[19]}),u.value.length>0?(p(),h("div",at,[r("div",ot,[a(n,{type:"primary",onClick:Ee,icon:g(De)},{default:o(()=>e[20]||(e[20]=[d(" 复制提示词 ")])),_:1,__:[20]},8,["icon"])]),r("div",lt,[e[21]||(e[21]=r("div",{class:"section-title"},"提示词原文",-1)),r("div",nt,[(p(!0),h(H,null,K(u.value,(l,_)=>(p(),A(Q,{key:_,closable:"",onClose:N=>xe(l.original_text),class:"cart-tag"},{default:o(()=>[d(P(l.original_text),1)]),_:2},1032,["onClose"]))),128))])]),r("div",st,[e[22]||(e[22]=r("div",{class:"section-title"},"中文翻译",-1)),r("div",rt,[(p(!0),h(H,null,K(u.value,(l,_)=>(p(),A(Q,{key:_,type:"info",class:"cart-tag-translation"},{default:o(()=>[d(P(l.chinese_translation),1)]),_:2},1024))),128))])])])):(p(),h("div",it,[a(Ne,{description:"购物车为空"})]))])]),footer:o(()=>[r("div",ct,[a(n,{onClick:W},{default:o(()=>e[23]||(e[23]=[d("清空购物车")])),_:1,__:[23]}),a(n,{type:"primary",onClick:Ve},{default:o(()=>e[24]||(e[24]=[d("保存为方案")])),_:1,__:[24]})])]),_:1},8,["modelValue"]),a(G,{modelValue:j.value,"onUpdate:modelValue":e[9]||(e[9]=l=>j.value=l),title:"保存方案",width:"400px"},{footer:o(()=>[r("span",ut,[a(n,{onClick:e[8]||(e[8]=l=>j.value=!1)},{default:o(()=>e[25]||(e[25]=[d("取消")])),_:1,__:[25]}),a(n,{type:"primary",onClick:be},{default:o(()=>e[26]||(e[26]=[d("保存")])),_:1,__:[26]})])]),default:o(()=>[a(R,{model:b.value,"label-width":"80px"},{default:o(()=>[a(E,{label:"方案名称"},{default:o(()=>[a(F,{modelValue:b.value.name,"onUpdate:modelValue":e[7]||(e[7]=l=>b.value.name=l),placeholder:"请输入方案名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(G,{modelValue:k.value,"onUpdate:modelValue":e[13]||(e[13]=l=>k.value=l),title:I.value?"编辑分类":"新建分类",width:"30%"},{footer:o(()=>[r("span",dt,[a(n,{onClick:e[12]||(e[12]=l=>k.value=!1)},{default:o(()=>e[27]||(e[27]=[d("取消")])),_:1,__:[27]}),a(n,{type:"primary",onClick:ue},{default:o(()=>e[28]||(e[28]=[d("确定")])),_:1,__:[28]})])]),default:o(()=>[a(R,{model:y.value,"label-width":"80px"},{default:o(()=>[a(E,{label:"分类名称"},{default:o(()=>[a(F,{modelValue:y.value.name,"onUpdate:modelValue":e[10]||(e[10]=l=>y.value.name=l),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),a(E,{label:"父级分类"},{default:o(()=>[a(X,{modelValue:y.value.parent_id,"onUpdate:modelValue":e[11]||(e[11]=l=>y.value.parent_id=l),data:B.value,props:{label:"name",children:"children",value:"id"},placeholder:"请选择父级分类",clearable:"","check-strictly":""},null,8,["modelValue","data"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1})}}}),vt=qe(pt,[["__scopeId","data-v-9f936367"]]);export{vt as default};
